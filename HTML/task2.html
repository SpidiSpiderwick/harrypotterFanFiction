<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">

    <script src="https://assets.crowd.aws/crowd-html-elements.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script>
        String.prototype.levenshtein = function (string) {
            let a = this, b = string + "", m = [], i, j;

            if (!(a && b)) return (b || a).length;

            for (i = 0; i <= b.length; m[i] = [i++]) ;
            for (j = 0; j <= a.length; m[0][j] = j++) ;

            for (i = 1; i <= b.length; i++) {
                for (j = 1; j <= a.length; j++) {
                    m[i][j] = b.charAt(i - 1) == a.charAt(j - 1)
                        ? m[i - 1][j - 1]
                        : m[i][j] = Math.min(
                            m[i - 1][j - 1] + 1,
                            Math.min(m[i][j - 1] + 1, m[i - 1][j] + 1))
                }
            }

            return m[b.length][a.length];
        }
        String.prototype.simplify = function () {
            return this.replace(/[^a-zA-Z0-9\-äöüß]/, " ").replace(/ +/, " ").trim().toLowerCase();
        }

        function percentToNumber(percentage, gTrans, translationfield) {
            return percentage * (gTrans.length + translationfield.length)
        }
    </script>
    <style>

        div {
            padding: 10px;
        }

        .container {
            display: flex;
            column-gap: 20px;
        }

        .containercolor {
            background-color: lightsteelblue;
        }

        .fixed {
            width: 100px;
        }

        .fixed_long {
            width: 500px;
        }

        .fixed_very_long {
            width: 1000px;
        }

        .center {
            margin: auto;
            width: 50%;
        }

        .centertext {
            text-align: center;
        }

        i {
            margin: 0 auto;
        }

        .centerpic {
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        .arrow {
            border: solid black;
            border-width: 0 3px 3px 0;
            display: inline-block;
            padding: 3px;
            text-align: center;
            margin: 0px auto;
        }

        .up {
            transform: rotate(-135deg);
            -webkit-transform: rotate(-135deg);
        }

        .down {
            transform: rotate(45deg);
            -webkit-transform: rotate(45deg);
        }

        .hovered {
            border: solid red;
        }

        .context {

        }

        .examplecell {
            background-color: lightsteelblue;
            padding: 10px;
            width: 300px;
            text-align: center
        }

        .my_blue {
            color: #A6A6FF;
        }

    </style>
    <script src="index.js"></script>
</head>
<body>

<!-- For the full list of available Crowd HTML Elements and their input/output documentation,
      please refer to https://docs.aws.amazon.com/sagemaker/latest/dg/sms-ui-template-reference.html -->

<!-- You must include crowd-form so that your task submits answers to MTurk ${image_url} -->

<crowd-form id="workform" answer-format="flatten-objects">

    <span id="qualidiv">


       <hr>

        <div id="errorBox"></div>

        <div style="margin:0 auto">
            <p>
                Bitte markieren Sie alle grammatikalisch richiten Deutsch Sätze.
            </p>
            <fieldset>
                <legend>What is Your Favorite Pet?</legend>
                <input type="checkbox" name="favorite_pet" value="Cats">Cats<br>
                <input type="checkbox" name="favorite_pet" value="Dogs">Dogs<br>
                <input type="checkbox" name="favorite_pet" value="Birds">Birds<br>
                <button onclick="qualibutton()">OK</button>
            </fieldset>

        </div>

    </span>

    <span id="workdiv" style="visibility: hidden">

        <crowd-instructions link-text="View instructions" link-type="button">
        <short-summary>
            <p>Bitte übersetzen Sie den folgenden Satz aus dem Englischen ins Deutsche.<br>
                Verwenden Sie dabei die Wörter, deren Übersetzungen bereits angegeben sind.<br>
                Stellen Sie sicher, dass Sie einen deutschen Satz angeben, den Sie angesichts des spezifischen
                Kontextes für passend und angemessen halten.</p>
        </short-summary>

        <detailed-instructions>
            <p>
                Ihnen wird ein englischer Satz vorgegeben, den Sie ins Deutsche übersetzen sollen. Inhaltlich geht
                es um Fanfiction-Literatur von Harry Potter. Gegebenenfalls sind einige Begriffe bereits für das
                Deutsch vorgegeben, diese sind zu übernehmen, z.B. the Dark Lord = der Dunkle Lord.
                <br><br>
                Das Ziel der Aufgabe besteht darin, einen idiomatischen Satz auf Deutsch zu formulieren, der
                angesichts des spezifischen Kontexts passend und angemessen ist.
                <br><br>
                Für eine dem Kontext angemessene Übersetzung haben Sie die Möglichkeit, den jeweils vorhergien Satz
                und den auf die zu übersetzende Einheit folgenden Satz einzusehen. Diese Sätze dienen lediglich der
                Orientierung und sind nicht zu übersetzen.
                <br><br>
                Die Sätze, die weitere Anhaltspunkte und Kontext bieten und nicht zu übersetzen sind, sind blau
                hinterlegt.
                <br><br>
                Das Übersetzen mithilfe von Software oder maschineller Übersetzung (etwa Google Translate oder
                DeepL) ist nicht erlaubt und ist zu unterlassen. Worker, die von maschinellen Übersetzungstools
                Gebrauch machen, werden für weitere Tasks blockiert. Ergebnisse, die nicht den Vorgaben entsprechen,
                werden abgelehnt.
                <br><br>
            <details>
                <summary>BEISPIEL</summary>
                <br><br>
                Übersetzen Sie diesen Satz:
                <br><br>
                <span style="font-size: xx-large">But I would never have imagined sharpening a <span
                        class="my_blue">Hufflepuff</span>’s bones into weapons.</span>
                <br><br>
                Verwenden Sie diese Übersetzungen:
                <br>
                <span class="my_blue">Hufflepuff</span> -> Hufflepuff<br><br>
                <table style="border-collapse:separate;border-spacing:50px 0;width:650px;table-layout:fixed">
                    <tr>
                        <td class="examplecell"><b>Vorheriger Kontext:</b></td>
                        <td class="examplecell"><b>Folgender Kontext:</b></td>
                    </tr>
                    <tr>
                        <td class="examplecell">I looked over to the skeleton, knowing exactly what I had to do.</td>
                        <td class="examplecell">Yet, I reached over.</td>
                    </tr>
                </table>
                <br><br>
                Da Hufflepuff vorgegeben ist, muss dieser Begriff nicht übersetzt werden, Genus und Kasus soll im
                Deutschen natürlich angepasst und grammatikalisch korrekt wiedergegeben werden. Alle übrigen Wörter
                sollen sie kontextgerecht nach ihrem Empfinden übersetzen. Die Sätze unterhalb sollen nicht übersetzt
                werden und dienen lediglich zum besseren Verständnis des Satzes im Kontext.
                <br><br>
                Eine beispielhafte Übersetzung lautet:
                <br><br>
                Aber ich hätte niemals daran gedacht, aus den Knochen eines Hufflepuffs eine Waffe zu schnitzen.
            </details>
            </p>
        </detailed-instructions>

        <positive-example>
            <p>This is the living-room of the house occupied by the eminent Professor Michael Verres-Evans, and his
                wife, Mrs. Petunia Evans-Verres, and their adopted son, Harry James Potter-Evans-Verres.</p>
            <p>Dies ist das Wohnzimmer des Hauses, welches vom angesehenen Professor Michael Verres-Evans, seiner
                Ehefrau Petunia Evans-Verres und ihrem Adoptivsohn Harry James Potter-Evans-Verres bewohnt
                wird. </p>
        </positive-example>

        <negative-example>
            <p>This is the living-room of the house occupied by the eminent Professor Michael Verres-Evans, and his
                wife, Mrs. Petunia Evans-Verres, and their adopted son, Harry James Potter-Evans-Verres.</p>
            <p>Das ist das Wohnzimmer von dem Haus, besetzt von dem hervorragenden Professor Michael Verres-Evans
                und seine Frau Mrs. Petunia Evans-Verres, und ihr adoptierter Sohn, Harry James
                Potter-Evans-Verres.</p>
            <p>Negativ ist die wortwörtliche Übersetzung sowie der falsche Kasus an zwei Stellen.</p>
        </negative-example>
    </crowd-instructions>

        <div>
            <h4>Erstellen Sie eine Synthese aus den folgenden Sätzen.</h4>
            <p>Behalten Sie die blau markierten Wörter bei, diese sollen nicht geändert werden.</p>
        </div>
        <div class="container">
        <div class="fixed center">
            <p>Satz 1:</p>
            <img class="centerpic" src=${image_url1} alt="alternatetext1">
        </div>
        <div class="fixed center">
            <p>Satz 2:</p>
            <img class="centerpic" src=${image_url2} alt="alternatetext2">
        </div>
        <div class="fixed center">
            <p>Satz 3:</p>
            <img class="centerpic" src=${image_url3} alt="alternatetext3">
        </div>
        </div>
        <div>

        <crowd-text-area name="translation" id="translation" rows="2" placeholder="Fügen Sie die Synthese hier ein..."
                         class="fixed_very_long"
                         required></crowd-text-area>
        </div>
        <body onload="starttime()"></body>
        <body onsubmit="savealerts(); timealert()"></body>


        <crowd-button form-action="submit">Submit</crowd-button>


        <crowd-text-area id="keylog" name="keylog" rows="1" style="visibility: hidden"></crowd-text-area>
        <crowd-text-area id="keylogalert" name="keylogalert" rows="1" style="visibility: hidden"></crowd-text-area>
        <crowd-text-area id="timealert" name="timealert" rows="1" style="visibility: hidden"></crowd-text-area>
    </span>
</crowd-form>

<script>
    let keylogfield = document.getElementById("keylog");

    function initkeylogger() {
        keylogfield.value = "";
        document.onkeypress = function (e) {
            get = window.event ? event : e;
            key = get.keyCode ? get.keyCode : get.charCode;
            key = String.fromCharCode(key);
            keylogfield.value += key;
        }
    }
</script>

<script>
    let qualification = document.getElementById("qualification");

    function qualibutton() {
        start_HIT()
    }

    function start_HIT() {
        document.getElementById("qualidiv").style.display = "none";
        document.getElementById("qualidiv").style.maxHeight = "0";
        document.getElementById("workdiv").style.visibility = "visible";
        initkeylogger();
        document.cookie = workerId + "=1;max-age=60*60*24*7";
    }

    var workerId = new URLSearchParams(window.location.search).get('workerId');
    console.log(window.location.search);
    console.log(new URLSearchParams(window.location.search));
    console.log(workerId);
    console.log(document.cookie);
    if (String(document.cookie).includes(workerId + "=1")) {
        start_HIT();
    }
</script>

<script>
    const my_blue = "#A6A6FF";
    let sugg_div = document.getElementById("suggestions");
    let str = "${suggestions}";
    str = str.replace(/'/g, '"');
    let suggestions = JSON.parse(str);
    if (suggestions && !$.isEmptyObject(suggestions)) {
        sugg_div.innerHTML += "<p>Verwenden Sie diese Übersetzungen:";
        for (const [eng, ger] of Object.entries(suggestions)) {
            sugg_div.innerHTML += '<span style="color:' + my_blue + ';">' + eng + '</span> &#8594; ' + ger + '<br>';
        }
        sugg_div.innerHTML += "</p>";
    }
</script>

<script>
    let start;

    function savealerts() {
        let workerinput = document.getElementById("translation");
        let keylogalert = document.getElementById("keylogalert");
        if (workerinput.value.length > keylogfield.value.length) {
            keylogalert.value = "TRUE";
        }
    }

    function starttime() {
        start = Date.now();
    }

    function timealert() {
        let timealert = document.getElementById("timealert");
        if (Date.now() - start < 30000) {
            timealert.value = "TRUE";
        }
    }

</script>

</body>
</html>